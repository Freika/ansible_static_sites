---

- name: Install curl
  apt: name=curl

- name: Add locale variables to /etc/environment
  become_user: root
  become: yes
  lineinfile:
    dest: /etc/environment
    line: "{{ item.line }}"
  with_items:
    - { line: LC_ALL=en_US.UTF-8 }

- name: Install libpq-dev for postgresql
  apt: name=libpq-dev

- name: Configure open ports with ufw.
  ufw:
    rule: "{{ item.rule }}"
    port: "{{ item.port }}"
    proto: "{{ item.proto }}"
  with_items:
    - { rule: 'allow', port: "{{ ssh_port }}", proto: 'tcp' }
    - { rule: 'allow', port: 80, proto: 'tcp' }
    - { rule: 'allow', port: 123, proto: 'udp' }

- name: Configure default incoming/outgoing rules with ufw.
  ufw:
    direction: "{{ item.direction }}"
    policy: "{{ item.policy }}"
    state: enabled
  with_items:
    - { direction: outgoing, policy: allow }
    - { direction: incoming, policy: deny }

- name: Install fail2ban
  apt: name=fail2ban state=present

- name: Ensure fail2ban is running and enabled on boot.
  service: name=fail2ban state=started enabled=yes
